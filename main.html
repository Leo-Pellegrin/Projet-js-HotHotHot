<!doctype html>
<html>
	<head>
		<title>HotHotHot</title>
        <link rel="stylesheet" href="../Projet-js-HotHotHot/style.css">
		<script src="package/dist/chart.js"></script>
		<meta charset="utf-8"/>
	</head>
	<body>
		<div class="container">

			<!-- Menu de navigation -->
			<nav>
				<button id="menu" onclick="toggleMenu()">Menu</button>
				<ul id="menu-box" role="tablist">
					<li role="tab"><a href="#temp">Température</a></li>
					<li role="tab"><a href="#histo">Historique</a></li>
					<li role="tab"><a href="#login">Se connecter</a></li>
					<li role="tab"><a href="#doc">Documentation</a></li>
				</ul>
			</nav>

			<!-- Section Accueil -->
			<section id="acceuil">
				<h1>HotHotHot</h1>
				<p> Bonjour, Bienvenue sur notre site ! </p>
			</section>

			<!-- SECTION TEMPERATURE -->
        	<section role="tabpanel" class='active' id="temp">
				<p id="p_temperature_ext">Affichage de la température extérieure: <span aria-live="assertive" id="span_temperature_ext"></span></p>
            	<p id="p_temperature_int">Affichage de la température intérieure: <span aria-live="assertive" id="span_temperature_int"></span></p>
			</section>

			<!-- SECTION HISTORIQUE -->
			<section id="histo" >
				<table role="tabpanel" id="histo">
					<tr><th colspan="2">Historique</th></tr>
					<tr>
						<th>Date</th>
						<th>Température</th>
					</tr>
					<tr id="ligne_modele">
						<td class="td_date"></td>
						<td class="td_temperature"></td>
					</tr>
				</table>
				<div>
					<canvas id="myChart" width="400" height="400">
					</canvas>
				</div>		
			</section>


			<!-- SECTION LOGIN 
			<section role="tabpanel" id="login">
				<p> Test login</p>
			</section> -->
		
			<!-- SECTION DOCUMENTATION -->
			<section role="tabpanel" id="doc">
				<p> Test doc</p>
			</section>

			<!-- BAS DE PAGE -->
			<footer>
				<h4>Bas de page</h4>
			</footer>
		</div>

		<script src="js/TempModel.js" charset="utf-8"></script>
		<script src="js/TempObserver.js" charset="utf-8"></script>
		<script src="js/AlerteObserver.js" charset="utf-8"></script>
		<script type="text/javascript">
			//Function pour afficher/cacher le menu
            function toggleMenu(){
                const contextMenu = document.getElementById("menu-box");
                if(contextMenu.style.display == "block"){
                    contextMenu.style.display = "none";
                }
                else{
                    contextMenu.style.display = "block"
                }
            }
            
			//Systemes d'onglets
            Array.from(document.querySelectorAll('nav ul li a')).forEach(function(element_a) {
				element_a.addEventListener('click', 
					function(event) {
						Array.from(document.querySelectorAll('.active')).forEach(function(element_section_ou_table) {
							element_section_ou_table.removeAttribute('class');
						});
						let element_a_id = event.target.attributes.href.value.replace('#', '');
						document.getElementById(element_a_id).setAttribute('class', 'active');
					}
				);
			});

			var section_ext = p_temperature_ext.parentNode;
            var section_int = p_temperature_int.parentNode;

			var TempModel = new TempModel();

			var TempObserverExt = new TempObserver(p_temperature_ext);
			var TempObserverInt = new TempObserver(p_temperature_int);

			var AlerteObserverExt = new AlerteObserver(section_ext);
			var AlerteObserverInt = new AlerteObserver(section_int);

			TempModel.addObservers(TempObserverExt);
			TempModel.addObservers(TempObserverInt);

			setInterval(TempModel.getValueFromApi(valueExt), 2000);
			setInterval(TempModel.getValueFromApi(valueInt), 2000);

			//Création du graphique 
			var canvas = document.getElementById("myChart");
			var data = {
				labels: ["0h", "2h", "4h", "6h", "8h", "10h", "12h"],
				datasets: [
					{
						label: 'My First dataset',
						backgroundColor: 'rgb(255, 99, 132)',
						borderColor: 'rgb(255, 99, 132)',
						data: [],
					},
					{
						label: "My Second dataset",
						backgroundColor: 'rgb(99, 255, 132)',
						borderColor: 'rgb(99, 132, 255)',
						data: [],
					}
				]
			};
			
			var option = {
				showLines: true,
				responsive: false
			};

			const config = {
				type: 'line',
				data: data,
				options: option
			};

			const myChart = new Chart(document.getElementById("myChart"), config);

			//Ajout d'une valeur au graphe
			setInterval(function adddata(model){
				myChart.data.datasets[0].data.push(model.valueExt);
				myChart.data.datasets[1].data.push(model.valueInt);
				myChart.data.labels.push("Newly added");
				myChart.update();
			}, 2000);
		</script>
	</body>
</html>